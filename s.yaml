edition: 1.0.0
name: working-time-app
access: default
services:
  framework:
    component: fc
    actions:       # 自定义执行逻辑，关于actions 的使用，可以参考：https://www.serverless-devs.com/serverless-devs/yaml#行为描述
      pre-deploy: # 在deploy之前运行
        - run: pip3 install -r requirements.txt -t .      # 要执行的系统命令，类似于一种钩子的形式
          path: ./                                    # 执行系统命令/钩子的路径
    props:
      region: cn-hangzhou
      service:
        name: working-time-service
        description: 'Working Time Management System'
        internetAccess: true
      function:
        name: working-time-app
        description: 'Flask application for working time management'
        runtime: python3.10
        handler: app.app
        environmentVariables:
          FLASK_APP: app.py
          FLASK_ENV: production
          PATH: /var/fc/lang/python3.10/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/code:/code/bin
          PYTHONPATH: /opt/python:/code
          LD_LIBRARY_PATH: /code:/code/lib:/usr/local/lib:/opt/lib
        initializer: pip install -r requirements-prod.txt
        layers:
          - acs:fc:cn-hangzhou:official:layers/Python3-Flask2x/versions/2
        memorySize: 1024
        cpu: 0.35
        timeout: 60
        codeUri: ./
        diskSize: 512
        instanceConcurrency: 5
        instanceType: e1
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
              - DELETE
            qualifier: LATEST
            enableCORS: true
      customDomains:
        - domainName: auto
          protocol: HTTP
          routeConfigs:
            - path: /*
              methods:
                - GET
                - POST
                - PUT
                - DELETE
